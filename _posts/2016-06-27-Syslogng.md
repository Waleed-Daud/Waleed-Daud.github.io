---
layout: post
title: Guide to Syslog-ng 
date:   2016-06-27 6:00:00 +0300
#image: /assets/img/Guide_to_syslogng.jpg

description: "let's get started !."
tags:
- Networks
- Tool
categories:
- Networks
twitter_text: ' A guide to syslog ng.'
---



**![syslogng-logo](https://infolosium.files.wordpress.com/2016/06/syslogng-logo.jpg)**

*   **Read time: 15 minutes.**

# <span style="text-decoration: underline;">Introduction:</span>

<span style="color: #000000;">Syslog-ng is an open source log management tool developed by [Balabit IT Security LTD.](https://www.balabit.com/)</span>

<span style="color: #000000;">Syslog-ng is developed from Syslog protocol for Unix and Linux systems. in fact Syslog-ng consists of three components:</span>

*   <span style="color: #000000;">Application for collecting events</span>
*   <span style="color: #000000;">Data which is logs collected.</span>
*   <span style="color: #000000;">Protocol for forwarding events.</span>

<span style="color: #000000;">There are two editions for Syslog-ng: Open Source Edition (OSE) and Premium Edition.</span> <span style="color: #000000;">OSE is available for Unix and Linux system. Windows supported in Premium Edition.</span>

# <span style="text-decoration: underline;">Installation:</span>

<span style="color: #000000;">I'm using CentOS , so this tutorial will cover installation in RedHat/Centos ,Ubuntu Distributions using OSE ,Windows users will find Guide for installation [here](https://www.balabit.com/sites/default/files/documents/syslog-ng-pe-latest-guides/en/syslog-ng-pe-guide-quickstart-windows/html-single/index.html#installation).</span>

### <span style="color: #000000;">RedHat/CentOS:</span>

<span style="color: #000000;">for centOS 6 add [this](https://copr.fedorainfracloud.org/coprs/czanik/syslog-ng37epel6/repo/epel-6/czanik-syslog-ng37epel6-epel-6.repo) repository and [this](https://copr.fedorainfracloud.org/coprs/czanik/syslog-ng37/repo/epel-7/czanik-syslog-ng37-epel-7.repo) for centOS 7 to yum.repos.d in /etc/yum.repos.d as follow:</span>

> #### <span style="color: #993366;">$ **cd /etc/yum.repos.d**</span>
>
> #### <span style="color: #993366;">$ **sudo vim syslog-ng.repo**</span>

<span style="color: #000000;">and paste those repositories . then :</span>

> <span style="color: #993366;">$ **sudo yum install syslog-ng**</span>

### <span style="color: #000000;">Ubuntu:</span>

<span style="color: #000000;">Syslog-ng has already existed in official Ubuntu Packages ,now type:</span>

> <span style="color: #993366;">$ **sudo apt-get install syslog-ng**</span>

<span style="color: #000000;">or:</span>

<span style="color: #000000;">if you have any error please do the following command instead.</span>

> <span style="color: #993366;">$ **sudo apt-get install syslog-ng syslog-ng-core**</span>

# <span style="color: #808080;">**<span style="text-decoration: underline;">Configurations:</span>**</span>

<span style="color: #000000;">To configure Syslog-ng ,you should know the basic structure of configuration, you can find Syslog-ng configuration file in **/etc/syslog-ng**.</span> <span style="color: #000000;">Syslog-ng configuration is divided into five parts:</span>

## <span style="color: #000000;">1-source:</span>

<span style="color: #000000;">Syslog-ng supported various types of inputs such as Unix-sockets,files,or you can receive logs from a remote server via TCP or UDP.</span>

### <span style="color: #000000;">syntax:</span>

> #### **<span style="color: #993366;">source any_name { source_functions();};</span>**

<span style="color: #000000;">look at these examples:</span>

> **<span style="color: #993366;">source nginx_source {internal(); file ("/var/log/nginx/error.log");};</span>**

<span style="color: #000000;">in this example, Syslog-ng takes its input from its logs and from a file called error.log in nginx directory.</span>

> **<span style="color: #993366;">source any_name { tcp (ip(54.23.12.34) port(2000));};</span>**

<span style="color: #000000;">this one takes inputs from remote server</span>.

* * *

## <span style="color: #000000;">2-filter:</span>

<span style="color: #000000;">when you have many traffics from many servers or you search for specific pattern importance of filters is come. Syslog-ng brings many filters that serve our need.</span> <span style="color: #000000;">syntax:</span>

> **<span style="color: #993366;">filter any_name { filter_functions();};</span>**

<span style="color: #000000;">these are some of the filter functions you can use:</span> **<span style="color: #000000;">netmask():filters logs based on their IPs.</span>**

> **<span style="color: #993366;">filter any_name { netmask(192.54.66.4/24);};</span>**

**<span style="color: #000000;">program(): filters logs based on their programs names in the log message .</span>**

> **<span style="color: #993366;">filter any_name { program(program name); };</span>**

<span style="color: #000000;">**message(): filter text of logs based on regular expression** .</span>

> <span style="color: #993366;">**filter {message(regular expression);};**</span>

<span style="color: #000000;">**level(): filter logs based on importance level**.</span>

> <span style="color: #993366;">**filter any_name {level(priority);};**</span> <span style="color: #993366;">**priority :warn ,crit ,err ,info ,.... or you can select range like: info..warn.**</span>

* * *

## <span style="color: #000000;">3-destination:</span>

<span style="color: #000000;">after setting your sources and filters ,now it's time to determine where your logs have to go.</span> <span style="color: #000000;">syntax:</span>

> <span style="color: #800080;">**destination any_name {destination functions();};**</span>

<span style="color: #000000;">look at these examples:</span>

> <span style="color: #800080;">**destination nginx_destination {tcp("43.65.78.3" port(5020));};**</span>

<span style="color: #000000;">now ,we send logs to the remote server through port 5020.</span>

* * *

## <span style="color: #000000;">4-options:</span>

<span style="color: #000000;">Syslog-ng provides good options to control the process of source management **such as Syslog-ng can accept or not timestamps <span style="color: #000000;">from source</span>**</span><span style="color: #000000;">,destination management **<span style="color: #000000;">such as Syslog-ng can create a directory for logs in remote server</span>** , log management <span style="color: #000000;">**such as what is the maximum size of output logs**</span>. these are some of the global options:</span><br>
**<span style="color: #000000;">log-msg-size():</span>** <span style="color: #000000;">maximum sent messages in bytes</span><br>
**<span style="color: #000000;"></span>**<span style="color: #000000;">**log_fifo_size():**the number of message that can output queue can store.</span><br>
**<span style="color: #000000;">flush_lines():</span>**<span style="color: #000000;">how many lines flushed to destination at time.</span><br>
**<span style="color: #000000;">flush_timeout():</span>**<span style="color: #000000;">the time syslog-ng waits in output queue to accumulate the lines which send to destination</span><br>
**<span style="color: #000000;">.</span><br><span style="color: #000000;">syntax:</span>**

> <span style="color: #800080;">**options {options functions();};**</span>

<span style="color: #000000;">example:</span>

> **<span style="color: #800080;">options {</span>**
> **<span style="color: #800080;">log_fifo_size(800);</span>**
> <br>
> **<span style="color: #800080;">owner(jacky);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;">#owner of logs files;</span></span>**
> <br>
> **<span style="color: #800080;">create_dirs(yes);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;"># create directory in destination.</span></span>** 
> <br>
> **<span style="color: #800080;">group(jacky);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;"># group of logs files</span></span>** 
> <br>
> **<span style="color: #800080;">dir_group(root);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;"># logs directory group .</span></span>**
> <br>
> **<span style="color: #800080;">use_dns(yes);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;"># use dns resolving or not.</span></span>**
> <br>
> **<span style="color: #800080;">keep_timestamp(no);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #000000;"># yes:use default time of logs ,no: use time of logs arriving.</span></span>****<span style="color: #800080;">};</span>**
* * *

## <span style="color: #000000;">5-log:</span>

<span style="color: #000000;">now it's time to flush our logs to its destination form sources controlled by global options.</span> <span style="color: #000000;">syslog-ng will never know how to work if you not include **log** section in configuration file.</span> <span style="color: #000000;">syntax:</span>

> <span style="color: #800080;">**log {source(source section name); filter(filter section name); destination(destination section name);};**</span>

* * *

<span style="color: #000000;">now let's see this full example:</span>

> **<span style="color: #800080;">options {</span>** <br>
> **<span style="color: #800080;">log_fifo_size(800);</span>** <br>
> **<span style="color: #800080;">owner(jacky);</span>** <br>
> **<span style="color: #800080;">create_dirs(yes);</span>** <br>
> **<span style="color: #800080;">group(jacky);</span>** <br>
> **<span style="color: #800080;">dir_group(root);</span>** <br>
> **<span style="color: #800080;">use_dns(yes);</span>** <br>
> **<span style="color: #800080;">keep_timestamp(no);</span>** <br>
> **<span style="color: #800080;">};<br>
> </span>****<span style="color: #800080;">source apache_source {tcp(ip(43.42.11.54) port (2050));};<br>
> </span>** **<span style="color: #800080;">filter apache_filter { level(warn);};</span>**<br>
> **<span style="color: #800080;">destination apache_dst { file("~/Apache_logs/apache.log");};</span>**<br>
> **<span style="color: #800080;">log { source ( apache_source); filter(apache_filter); destination(apache_dst);};</span>**

<span style="color: #000000;">in this example, we set global options then set our source to remote server and destination to apache.log file in Apache_logs directory .</span>

* * *

# **<span style="color: #666699;">Troubleshooting:</span>**

<span style="color: #000000;">when you do any work ,you should know how to troubleshoot it .you can make troubleshooting on syslog-ng by :</span>

*   **<span style="color: #000000;">start syslog-ng service in debug mode.</span>**

> <span style="color: #800080;">**$ sudo syslog-ng -Fevd**</span>

-F, –foreground Do not go into the background after initialization  <br> -v, –verbose Be a bit more verbose. <br> -d, –debug Enable debug messages. <br> -e, –stderr Log messages to stderr.

*   **<span style="color: #000000;">use journalctl -xe :</span>**

> **<span style="color: #800080;">$ journalctl -xe</span>**

*   <span style="color: #000000;">use **nc -lp (port number) to listen to destination logs.**</span>

> <span style="color: #800080;">**$ nc -lp 2000**</span>

*   <span style="color: #000000;">**use tcpdump**</span>

> <span style="color: #800080;">$ sudo tcpdump -nS dst 192.168.9.4 port 2000</span>

* * *

<span style="color: #000000;">now you have a solid foundation on Syslog-ng ,for more information please check resources below .</span>

* * *

# <span style="color: #000000;">Resources:</span>

[Balabit Documentation.](https://www.balabit.com/sites/default/files/documents/syslog-ng-ose-latest-guides/en/syslog-ng-ose-guide-admin/html/index.html) <br> [more about troubleshooting](https://pzolee.blogs.balabit.com/2009/12/troubleshooting-and-debugging-syslog-ng/). <br> [Balabit youtube channel](https://www.youtube.com/channel/UCWzW5Z0rzGXim0pUYyThQ4w).

